<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞ ‚Äî –ü—Ä–æ—Ç–æ—Ç–∏–ø UI</title>
<style>
  :root{
  --bg:#f8f9fb;
  --card:#ffffff;
  --accent:#1f2937;
  --muted:#6b7280;
  --border:#e5e7eb;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto;
  background:var(--bg);
  color:#111827;
}

/* HEADER */
header{
  display:flex; align-items:center; gap:2px;
  padding:2px 22px;
  background:var(--card);
  border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:10;
}
header h1{margin:0; font-size:18px; font-weight:600}
header p{margin:0; color:var(--muted); font-size:13px}

.layout{
  display:grid; grid-template-columns:240px 1fr;
  gap:20px; padding:20px;
  max-width:1200px; margin:20px auto;
}

/* SIDEBAR */
nav.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px;
  height:calc(100vh - 110px);
  overflow:auto;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:10px;
  padding:16px;
}

.menu-item{
  display:flex; align-items:center; gap:12px;
  padding:8px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
}
.menu-item:hover{
  background:#f3f4f6;
}
.menu-item.active{
  background:#111827;
  color:white;
}

/* TEXTS */
h2{margin:0 0 14px 0; font-size:18px; font-weight:600}
label{font-size:13px; margin-bottom:4px; color:var(--muted)}

/* INPUTS */
input,select,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:6px;
  border:1px solid var(--border);
  background:white;
  font-size:14px;
}

/* BUTTONS */
.btn{
  padding:8px 12px; border-radius:6px;
  border:1px solid var(--border);
  background:white; cursor:pointer;
  font-size:14px;
}
.btn:hover{background:#f3f4f6}

.btn.primary{
  background:#111827; color:white;
  border:1px solid #111827;
}
.btn.primary:hover{background:#1f2937}

/* TABLE */
table{width:100%; border-collapse:collapse; font-size:14px}
th{
  text-align:left; padding:8px;
  border-bottom:1px solid var(--border);
  color:var(--muted); font-weight:500; font-size:13px;
}
td{
  padding:8px; border-bottom:1px solid var(--border);
}

/* SMALL ELEMENTS */
.small{font-size:13px; color:var(--muted)}
.muted{color:var(--muted); font-size:13px}
.pill{
  padding:4px 8px; border-radius:999px;
  background:#f3f4f6; font-size:12px;
  color:#111827;
}

.toolbar{display:flex;gap:8px;align-items:center;margin-bottom:12px}
.actions{display:flex;gap:8px}

.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}

/* RESPONSIVE */
@media(max-width:900px){
  .layout{grid-template-columns:1fr}
  nav.card{height:auto}
}

</style>
</head>
<body>

<header>
  <div style="display:flex;flex-direction:column">
    <h1>–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞ ‚Äî –ü—Ä–æ—Ç–æ—Ç–∏–ø</h1>
    <p>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ü–µ–Ω—Ç—Ä–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –ø–æ–¥–±–æ—Ä –∏ –æ—Ç—á—ë—Ç—ã</p>
  </div>
  <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
    <div class="pill">v1.0</div>
  </div>
</header>

<div class="layout">
  <nav class="card" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
    <div style="margin-bottom:10px;font-weight:700;color:var(--muted)">–ú–µ–Ω—é</div>

    <div id="m-list" role="menu">
      <div class="menu-item active" data-view="dashboard"><span>üè†</span><span>–ü–∞–Ω–µ–ª—å</span></div>
      <div class="menu-item" data-view="unemployed"><span>üë•</span><span>–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–µ</span></div>
      <div class="menu-item" data-view="employers"><span>üè¢</span><span>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è</span></div>
      <div class="menu-item" data-view="vacancies"><span>üìã</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></div>
      <div class="menu-item" data-view="match"><span>üîé</span><span>–ü–æ–¥–±–æ—Ä</span></div>
      <div class="menu-item" data-view="reports"><span>üìä</span><span>–û—Ç—á—ë—Ç—ã</span></div>
      <div class="menu-item" data-view="help"><span>‚ùî</span><span>–°–ø—Ä–∞–≤–∫–∞</span></div>
    </div>

    <div style="margin-top:18px" class="small muted">
      –ü–æ–¥—Å–∫–∞–∑–∫–∞: –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (localStorage). –ú–æ–∂–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å CSV –æ—Ç—á—ë—Ç—ã.
    </div>
  </nav>

  <main>
    <!-- DASHBOARD -->
    <section class="card" id="view-dashboard">
      <h2>–ü–∞–Ω–µ–ª—å</h2>
      <div class="grid-2">
        <div>
          <div class="card" style="margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="muted">–í—Å–µ–≥–æ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π</div>
                <div id="stat-unemployed" style="font-size:20px;font-weight:700">0</div>
              </div>
              <div>
                <div class="muted">–í–∞–∫–∞–Ω—Å–∏–π</div>
                <div id="stat-vacancies" style="font-size:20px;font-weight:700">0</div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="muted">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–∏</div>
            <div id="recent-unemployed" style="margin-top:8px"></div>
          </div>
        </div>

        <div>
          <div class="card" style="margin-bottom:12px">
            <div class="muted">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏</div>
            <div id="recent-vacancies" style="margin-top:8px"></div>
          </div>

          <div class="card">
            <div class="muted">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
            <div style="margin-top:10px;display:flex;gap:8px">
              <button class="btn primary" onclick="showView('unemployed')">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è</button>
              <button class="btn ghost" onclick="showView('vacancies')">–î–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
              <button class="btn ghost" onclick="showView('match')">–ü–æ–¥–±–æ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- UNEMPLOYED -->
    <section class="card" id="view-unemployed" style="display:none">
      <h2>–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–µ</h2>

      <div class="card" style="margin-bottom:12px">
        <form id="form-unemployed">
          <div class="grid-2">
            <div>
              <label>–§–ò–û</label>
              <input type="text" id="u-name" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
            </div>
            <div>
              <label>–í–æ–∑—Ä–∞—Å—Ç</label>
              <input type="number" id="u-age" min="14" max="100" required>
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</label>
              <select id="u-education">
                <option value="–ù–µ —É–∫–∞–∑–∞–Ω–æ">–ù–µ —É–∫–∞–∑–∞–Ω–æ</option>
                <option>–°—Ä–µ–¥–Ω–µ–µ</option>
                <option>–°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ</option>
                <option>–í—ã—Å—à–µ–µ</option>
              </select>
            </div>
            <div style="flex:1">
              <label>–°—Ç–∞–∂ (–ª–µ—Ç)</label>
              <input type="number" id="u-exp" min="0" value="0">
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è / —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</label>
              <input type="text" id="u-prof" placeholder="–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, —É—á–∏—Ç–µ–ª—å, —Å–ª–µ—Å–∞—Ä—å">
            </div>
            <div style="flex:1">
              <label>–ó–Ω–∞–Ω–∏–µ –ü–ö / —è–∑—ã–∫–æ–≤</label>
              <input type="text" id="u-skills" placeholder="Excel, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π">
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è</button>
            <button class="btn ghost" type="button" onclick="clearUnemployedForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="toolbar">
          <input id="search-unemployed" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ / –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏" style="padding:8px;border-radius:8px;border:1px solid #e6eef8;flex:1">
          <div class="actions">
            <button class="btn ghost" onclick="exportCSV('unemployed')">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button class="btn ghost" onclick="seedSample('unemployed')">–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–µ—Ü</button>
            <button class="btn ghost" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
          </div>
        </div>

        <div style="overflow:auto;max-height:320px">
          <table id="table-unemployed" aria-live="polite">
            <thead><tr><th>–§–ò–û</th><th>–í–æ–∑—Ä–∞—Å—Ç</th><th>–ü—Ä–æ—Ñ–µ—Å—Å–∏—è</th><th>–û–ø—ã—Ç</th><th>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- EMPLOYERS -->
    <section class="card" id="view-employers" style="display:none">
      <h2>–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è</h2>

      <div class="card" style="margin-bottom:12px">
        <form id="form-employer">
          <div class="row">
            <div style="flex:1">
              <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è</label>
              <input type="text" id="e-name" required>
            </div>
            <div style="flex:1">
              <label>–ê–¥—Ä–µ—Å</label>
              <input type="text" id="e-address">
            </div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ</button>
            <button class="btn ghost" type="button" onclick="clearEmployerForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="toolbar">
          <input id="search-employers" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é" style="padding:8px;border-radius:8px;border:1px solid #e6eef8;flex:1">
          <div class="actions">
            <button class="btn ghost" onclick="seedSample('employers')">–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑—Ü—ã</button>
            <button class="btn ghost" onclick="exportCSV('employers')">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          </div>
        </div>

        <div style="overflow:auto;max-height:320px">
          <table id="table-employers"><thead><tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ê–¥—Ä–µ—Å</th><th></th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </section>

    <!-- VACANCIES -->
    <section class="card" id="view-vacancies" style="display:none">
      <h2>–í–∞–∫–∞–Ω—Å–∏–∏</h2>

      <div class="card" style="margin-bottom:12px">
        <form id="form-vacancy">
          <div class="row">
            <div style="flex:1">
              <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
              <input type="text" id="v-title" required placeholder="–ú–µ–Ω–µ–¥–∂–µ—Ä, –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç">
            </div>
            <div style="flex:1">
              <label>–ö–æ–º–ø–∞–Ω–∏—è (–Ω–∞–∑–≤–∞–Ω–∏–µ)</label>
              <input type="text" id="v-company" required placeholder="–û–û–û –†–æ–º–∞—à–∫–∞">
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è (–∫—Ä–∞—Ç–∫–æ)</label>
              <input type="text" id="v-req" placeholder="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ, —è–∑—ã–∫–∏, –Ω–∞–≤—ã–∫–∏">
            </div>
            <div style="flex:1">
              <label>–û–ø—ã—Ç (–ª–µ—Ç)</label>
              <input type="number" id="v-exp" min="0" value="0">
            </div>
          </div>

          <div class="row">
            <div style="flex:1">
              <label>–ó–∞—Ä–ø–ª–∞—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <input type="text" id="v-salary" placeholder="–æ—Ç 100 000">
            </div>
            <div style="flex:1">
              <label>–î–∞—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è</label>
              <input type="date" id="v-date" value="">
            </div>
          </div>

          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn primary" type="submit">–î–æ–±–∞–≤–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
            <button class="btn ghost" type="button" onclick="clearVacancyForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn ghost" type="button" onclick="seedSample('vacancies')">–û–±—Ä–∞–∑–µ—Ü</button>
          </div>
        </form>
      </div>

      <div class="card">
        <div class="toolbar">
          <input id="search-vacancies" placeholder="–ü–æ–∏—Å–∫ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ / –∫–æ–º–ø–∞–Ω–∏–∏" style="padding:8px;border-radius:8px;border:1px solid #e6eef8;flex:1">
          <div class="actions">
            <button class="btn ghost" onclick="exportCSV('vacancies')">–≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          </div>
        </div>

        <div style="overflow:auto;max-height:360px">
          <table id="table-vacancies"><thead><tr><th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th><th>–ö–æ–º–ø–∞–Ω–∏—è</th><th>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</th><th>–û–ø—ã—Ç</th><th>–î–∞—Ç–∞</th><th></th></tr></thead><tbody></tbody></table>
        </div>
      </div>
    </section>

    <!-- MATCH -->
    <section class="card" id="view-match" style="display:none">
      <h2>–ü–æ–¥–±–æ—Ä –≤–∞–∫–∞–Ω—Å–∏–π</h2>

      <div class="card" style="margin-bottom:12px">
        <div class="grid-2">
          <div>
            <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è</label>
            <select id="match-unemployed" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8"></select>
          </div>

          <div>
            <label>–§–∏–ª—å—Ç—Ä –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º—É –æ–ø—ã—Ç—É (–ª–µ—Ç)</label>
            <input type="number" id="match-exp" value="0" min="0" style="padding:10px;border-radius:8px;border:1px solid #e6eef8">
          </div>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn primary" onclick="runMatch()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–¥–±–æ—Ä</button>
          <button class="btn ghost" onclick="clearMatch()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>

      <div class="card">
        <div class="muted">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</div>
        <div id="match-results" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- REPORTS -->
    <section class="card" id="view-reports" style="display:none">
      <h2>–û—Ç—á—ë—Ç—ã</h2>

      <div class="card" style="margin-bottom:12px">
        <div class="row">
          <div style="flex:1">
            <label>–ü–µ—Ä–∏–æ–¥ —Å</label>
            <input type="date" id="r-from">
          </div>
          <div style="flex:1">
            <label>–ø–æ</label>
            <input type="date" id="r-to">
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn primary" onclick="generateReport()">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
          <button class="btn ghost" onclick="exportReportCSV()">–≠–∫—Å–ø–æ—Ä—Ç CSV –æ—Ç—á—ë—Ç–∞</button>
        </div>
      </div>

      <div class="card">
        <div id="report-area" class="muted">–û—Ç—á—ë—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å.</div>
      </div>
    </section>

    <!-- HELP -->
    <section class="card" id="view-help" style="display:none">
      <h2>–°–ø—Ä–∞–≤–∫–∞</h2>
      <div class="muted">
        –≠—Ç–æ —É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ "–†—ã–Ω–æ–∫ —Ç—Ä—É–¥–∞". <br><br>
        –ß—Ç–æ —É–º–µ–µ—Ç:
        <ul>
          <li>–î–æ–±–∞–≤–ª—è—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π, –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è –∏ –≤–∞–∫–∞–Ω—Å–∏–∏.</li>
          <li>–ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–æ—Ä–∞ –≤–∞–∫–∞–Ω—Ç–Ω—ã—Ö –º–µ—Å—Ç –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏, –æ–ø—ã—Ç—É –∏ –Ω–∞–≤—ã–∫–∞–º.</li>
          <li>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤.</li>
        </ul>
        –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±—Ä–∞—É–∑–µ—Ä–∞ (localStorage). –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω—É–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –ë–î.
      </div>
    </section>

  </main>
</div>

<footer>–ü—Ä–æ—Ç–æ—Ç–∏–ø –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî —É—á–µ–±–Ω–∞—è —Ä–∞–±–æ—Ç–∞. –î–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä.</footer>

<script>
/* --- Utilities & Storage --- */
const LS_KEY = 'job_market_data_v1';

function loadData(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw) {
    const init = {unemployed:[], employers:[], vacancies:[]};
    localStorage.setItem(LS_KEY, JSON.stringify(init));
    return init;
  }
  try { return JSON.parse(raw); } catch(e){ return {unemployed:[], employers:[], vacancies:[]} }
}
function saveData(data){
  localStorage.setItem(LS_KEY, JSON.stringify(data));
}

/* --- UI navigation --- */
function showView(view){
  document.querySelectorAll('section.card').forEach(s=>s.style.display='none');
  const el = document.getElementById('view-'+view);
  if(el) el.style.display='block';
  // menu
  document.querySelectorAll('.menu-item').forEach(mi=>mi.classList.toggle('active', mi.dataset.view===view));
  // update some dynamic selects when showing specific views
  if(view==='match') refreshMatchSelect();
  if(view==='dashboard') renderDashboard();
}
document.querySelectorAll('.menu-item').forEach(mi=>{
  mi.addEventListener('click', ()=> showView(mi.dataset.view));
});

/* --- Rendering tables --- */
// Helper to get today's date string yyyy-mm-dd
function todayISO(){ return new Date().toISOString().slice(0,10); }

function renderUnemployed(filter){
  const data = loadData();
  const tbody = document.querySelector('#table-unemployed tbody');
  tbody.innerHTML = '';
  const q = filter ? filter.toLowerCase() : '';
  data.unemployed.forEach((u, idx) => {
    if(q){
      const name = (u.name||'').toLowerCase();
      const prof = (u.prof||'').toLowerCase();
      if(!name.includes(q) && !prof.includes(q)) return;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(u.name||'')}</td>
      <td>${u.age||''}</td>
      <td>${escapeHtml(u.prof||'')}</td>
      <td>${u.exp||0} –≥.</td>
      <td>${escapeHtml(u.education||'')}</td>
      <td style="text-align:right">
        <button class="btn ghost" onclick="editUnemployed(${idx})">–†–µ–¥.</button>
        <button class="btn" style="background:var(--danger);color:white" onclick="deleteUnemployed(${idx})">–£–¥–∞–ª.</button>
      </td>`;
    tbody.appendChild(tr);
  });
  // recent
  const recentList = data.unemployed.slice(-3).reverse();
  const recent = recentList.map(u=>`<div class="small">${escapeHtml(u.name||'')} ‚Äî ${escapeHtml(u.prof||'')}</div>`).join('');
  document.getElementById('recent-unemployed').innerHTML = recent || '<div class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
  document.getElementById('stat-unemployed').textContent = data.unemployed.length;
}

function renderEmployers(filter){
  const data = loadData();
  const tbody = document.querySelector('#table-employers tbody');
  tbody.innerHTML = '';
  const q = filter ? filter.toLowerCase() : '';
  data.employers.forEach((e, idx)=>{
    if(q && !(e.name||'').toLowerCase().includes(q)) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(e.name)}</td><td>${escapeHtml(e.address||'')}</td>
      <td style="text-align:right">
        <button class="btn ghost" onclick="editEmployer(${idx})">–†–µ–¥.</button>
        <button class="btn" style="background:var(--danger);color:white" onclick="deleteEmployer(${idx})">–£–¥–∞–ª.</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function renderVacancies(filter){
  const data = loadData();
  const tbody = document.querySelector('#table-vacancies tbody');
  tbody.innerHTML = '';
  const q = filter ? filter.toLowerCase() : '';
  data.vacancies.forEach((v, idx)=>{
    if(q){
      const title = (v.title||'').toLowerCase();
      const comp = (v.company||'').toLowerCase();
      if(!title.includes(q) && !comp.includes(q)) return;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(v.title)}</td><td>${escapeHtml(v.company)}</td><td>${escapeHtml(v.req||'')}</td><td>${v.exp||0}</td><td>${v.date||''}</td>
      <td style="text-align:right">
        <button class="btn ghost" onclick="editVacancy(${idx})">–†–µ–¥.</button>
        <button class="btn" style="background:var(--danger);color:white" onclick="deleteVacancy(${idx})">–£–¥–∞–ª.</button>
      </td>`;
    tbody.appendChild(tr);
  });
  // recent vacancies
  const recentList = data.vacancies.slice(-3).reverse();
  const recent = recentList.map(v=>`<div class="small">${escapeHtml(v.title||'')} ‚Äî ${escapeHtml(v.company||'')}</div>`).join('');
  document.getElementById('recent-vacancies').innerHTML = recent || '<div class="muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
  document.getElementById('stat-vacancies').textContent = data.vacancies.length;
}

/* --- Forms handling --- */
document.getElementById('form-unemployed').addEventListener('submit', function(e){
  e.preventDefault();
  const data = loadData();
  const u = {
    name: document.getElementById('u-name').value.trim(),
    age: Number(document.getElementById('u-age').value)||'',
    education: document.getElementById('u-education').value,
    exp: Number(document.getElementById('u-exp').value)||0,
    prof: document.getElementById('u-prof').value.trim(),
    skills: document.getElementById('u-skills').value.trim(),
    created: new Date().toISOString()
  };
  // if editing?
  if(document.getElementById('form-unemployed').dataset.editIndex){
    const idx = Number(document.getElementById('form-unemployed').dataset.editIndex);
    if(Number.isFinite(idx) && data.unemployed[idx]) data.unemployed[idx] = u;
    delete document.getElementById('form-unemployed').dataset.editIndex;
  } else data.unemployed.push(u);
  saveData(data);
  renderUnemployed(document.getElementById('search-unemployed').value);
  renderMatchSelect();
  this.reset();
});

document.getElementById('form-employer').addEventListener('submit', function(e){
  e.preventDefault();
  const data = loadData();
  const eObj = {
    name: document.getElementById('e-name').value.trim(),
    address: document.getElementById('e-address').value.trim(),
    created: new Date().toISOString()
  };
  if(this.dataset.editIndex){
    const idx = Number(this.dataset.editIndex);
    if(Number.isFinite(idx) && data.employers[idx]) data.employers[idx] = eObj;
    delete this.dataset.editIndex;
  } else data.employers.push(eObj);
  saveData(data);
  renderEmployers(document.getElementById('search-employers').value);
  this.reset();
});
document.getElementById('form-vacancy').addEventListener('submit', function(e){
  e.preventDefault();
  const data = loadData();
  const dateVal = document.getElementById('v-date').value || todayISO();
  const v = {
    title: document.getElementById('v-title').value.trim(),
    company: document.getElementById('v-company').value.trim(),
    req: document.getElementById('v-req').value.trim(),
    exp: Number(document.getElementById('v-exp').value)||0,
    salary: document.getElementById('v-salary').value.trim(),
    date: dateVal,
    created: new Date().toISOString()
  };
  if(this.dataset.editIndex){
    const idx = Number(this.dataset.editIndex);
    if(Number.isFinite(idx) && data.vacancies[idx]) data.vacancies[idx] = v;
    delete this.dataset.editIndex;
  } else data.vacancies.push(v);
  saveData(data);
  renderVacancies(document.getElementById('search-vacancies').value);
  renderMatchSelect();
  this.reset();
});

/* --- Edit / Delete functions --- */
function editUnemployed(idx){
  const data = loadData();
  const u = data.unemployed[idx];
  if(!u) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
  document.getElementById('u-name').value = u.name;
  document.getElementById('u-age').value = u.age;
  document.getElementById('u-education').value = u.education;
  document.getElementById('u-exp').value = u.exp;
  document.getElementById('u-prof').value = u.prof;
  document.getElementById('u-skills').value = u.skills;
  document.getElementById('form-unemployed').dataset.editIndex = idx;
  showView('unemployed');
}
function deleteUnemployed(idx){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è?')) return;
  const data = loadData();
  if(idx<0 || idx>=data.unemployed.length) return;
  data.unemployed.splice(idx,1);
  saveData(data);
  renderUnemployed(document.getElementById('search-unemployed').value);
  renderMatchSelect();
}

function editEmployer(idx){
  const data = loadData();
  const e = data.employers[idx];
  if(!e) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
  document.getElementById('e-name').value = e.name;
  document.getElementById('e-address').value = e.address;
  document.getElementById('form-employer').dataset.editIndex = idx;
  showView('employers');
}
function deleteEmployer(idx){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ?')) return;
  const data = loadData();
  if(idx<0 || idx>=data.employers.length) return;
  data.employers.splice(idx,1);
  saveData(data);
  renderEmployers(document.getElementById('search-employers').value);
}

function editVacancy(idx){
  const data = loadData();
  const v = data.vacancies[idx];
  if(!v) return alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ');
  document.getElementById('v-title').value = v.title;
  document.getElementById('v-company').value = v.company;
  document.getElementById('v-req').value = v.req;
  document.getElementById('v-exp').value = v.exp;
  document.getElementById('v-salary').value = v.salary;
  document.getElementById('v-date').value = v.date || todayISO();
  document.getElementById('form-vacancy').dataset.editIndex = idx;
  showView('vacancies');
}
function deleteVacancy(idx){
  if(!confirm('–£–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é?')) return;
  const data = loadData();
  if(idx<0 || idx>=data.vacancies.length) return;
  data.vacancies.splice(idx,1);
  saveData(data);
  renderVacancies(document.getElementById('search-vacancies').value);
  renderMatchSelect();
}

/* --- Matching algorithm (simple heuristic) --- */
function refreshMatchSelect(){
  const sel = document.getElementById('match-unemployed');
  const data = loadData();
  sel.innerHTML = '<option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>';
  data.unemployed.forEach((u, i) => {
    const txt = `${u.name} ‚Äî ${u.prof||'–Ω–µ —É–∫–∞–∑–∞–Ω–∞'}`;
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = txt;
    sel.appendChild(opt);
  });
}

function runMatch(){
  const idx = document.getElementById('match-unemployed').value;
  if(idx===''){ alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è'); return; }
  const minExp = Number(document.getElementById('match-exp').value)||0;
  const data = loadData();
  const u = data.unemployed[Number(idx)];
  if(!u) return;
  // compute score: match by title/prof substring, experience, skills & education
  const results = data.vacancies.map((v, i) => {
    let score = 0;
    // profession/title match
    const prof = (u.prof||'').toLowerCase();
    const title = (v.title||'').toLowerCase();
    if(prof && title && (title.includes(prof) || prof.includes(title))) score += 50;
    // skills in req
    const skills = (u.skills||'').toLowerCase();
    const req = (v.req||'').toLowerCase();
    if(skills && req){
      const tokens = skills.split(/[,;]+|\s+/).filter(Boolean);
      tokens.forEach(t => { if(req.includes(t)) score += 8; });
    }
    // experience: if candidate exp >= vacancy exp
    if(u.exp >= v.exp) score += 20; else {
      const diff = v.exp - u.exp;
      score += Math.max(0, 20 - diff*5); // penalize
    }
    // education quick match (not strict)
    if(u.education && v.req && v.req.toLowerCase().includes(u.education.toLowerCase())) score += 6;
    // filter by minExp
    if(u.exp < minExp) score -= 100; // exclude
    return {v, idx:i, score: Math.max(0, Math.round(score))};
  }).filter(r=>r.score>0).sort((a,b)=>b.score-a.score);

  const out = document.getElementById('match-results');
  if(results.length===0){ out.innerHTML = '<div class="muted">–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>'; return; }
  out.innerHTML = '<table><thead><tr><th>–í–∞–∫–∞–Ω—Å–∏—è</th><th>–ö–æ–º–ø–∞–Ω–∏—è</th><th>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</th><th>–û–ø—ã—Ç</th><th>–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ</th><th></th></tr></thead><tbody></tbody></table>';
  const tbody = out.querySelector('tbody');
  results.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(r.v.title)}</td><td>${escapeHtml(r.v.company)}</td><td>${escapeHtml(r.v.req)}</td><td>${r.v.exp}</td><td><span class="match-score">${r.score}%</span></td>
      <td style="text-align:right"><button class="btn primary" onclick="applyVacancy(${r.idx}, ${Number(idx)})">–û—Ç–∫–ª–∏–∫</button></td>`;
    tbody.appendChild(tr);
  });
}

/* --- Simulate applying (local only) --- */
function applyVacancy(vIdx, uIdx){
  const data = loadData();
  const v = data.vacancies[vIdx];
  const u = data.unemployed[uIdx];
  alert(`–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:\n${u.name} ‚Üí ${v.title} (${v.company})\n(–í –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ –æ—Ç–∫–ª–∏–∫ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª–∏—Ä—É–µ—Ç—Å—è)`);
}

/* --- Reports --- */
function generateReport(){
  const from = document.getElementById('r-from').value;
  const to = document.getElementById('r-to').value;
  const data = loadData();
  let html = '<div class="muted">';
  html += `<div>–ü–µ—Ä–∏–æ–¥: ${from || '‚Äî'} ‚Äî ${to || '‚Äî'}</div>`;
  html += `<div style="margin-top:8px">–í—Å–µ–≥–æ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π: ${data.unemployed.length}</div>`;
  html += `<div>–í—Å–µ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π: ${data.vacancies.length}</div>`;
  // grouped by profession (top 8)
  const profCount = {};
  data.unemployed.forEach(u => {
    const key = (u.prof||'–ù–µ —É–∫–∞–∑–∞–Ω–∞').trim();
    profCount[key] = (profCount[key]||0) + 1;
  });
  const top = Object.entries(profCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  html += '<div style="margin-top:8px">–¢–æ–ø –ø—Ä–æ—Ñ–µ—Å—Å–∏–π —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π:<ul>';
  top.forEach(t=> html += `<li>${escapeHtml(t[0])}: ${t[1]}</li>`);
  html += '</ul></div>';
  html += '</div>';
  document.getElementById('report-area').innerHTML = html;
}
function exportReportCSV(){
  const data = loadData();
  const rows = [['–¢–∏–ø','–ù–∞–∑–≤–∞–Ω–∏–µ','–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ']];
  rows.push(['–°–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π', data.unemployed.length, '']);
  rows.push(['–í–∞–∫–∞–Ω—Å–∏–π', data.vacancies.length, '']);
  rows.push([]);
  rows.push(['–ü—Ä–æ—Ñ–µ—Å—Å–∏—è','–ö–æ–ª-–≤–æ']);
  const profCount = {};
  data.unemployed.forEach(u => {
    const key = (u.prof||'–ù–µ —É–∫–∞–∑–∞–Ω–∞').trim();
    profCount[key] = (profCount[key]||0) + 1;
  });
  Object.entries(profCount).forEach(e => rows.push([e[0], e[1]]));
  downloadCSV(rows, 'report_job_market.csv');
}

/* --- Export CSV generic --- */
function exportCSV(type){
  const data = loadData();
  const rows = [];
  if(type==='unemployed'){
    rows.push(['–§–ò–û','–í–æ–∑—Ä–∞—Å—Ç','–ü—Ä–æ—Ñ–µ—Å—Å–∏—è','–û–ø—ã—Ç','–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ','–ù–∞–≤—ã–∫–∏']);
    data.unemployed.forEach(u => rows.push([u.name,u.age,u.prof,u.exp,u.education,u.skills]));
  } else if(type==='employers'){
    rows.push(['–ù–∞–∑–≤–∞–Ω–∏–µ','–ê–¥—Ä–µ—Å']);
    data.employers.forEach(e => rows.push([e.name,e.address]));
  } else if(type==='vacancies'){
    rows.push(['–î–æ–ª–∂–Ω–æ—Å—Ç—å','–ö–æ–º–ø–∞–Ω–∏—è','–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è','–û–ø—ã—Ç','–ó–∞—Ä–ø–ª–∞—Ç–∞','–î–∞—Ç–∞']);
    data.vacancies.forEach(v => rows.push([v.title,v.company,v.req,v.exp,v.salary,v.date]));
  }
  downloadCSV(rows, `${type}.csv`);
}
function downloadCSV(rows, filename){
  const csv = rows.map(r => r.map(cell => `"${(cell||'').toString().replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

/* --- Helpers --- */
function escapeHtml(s){ return s ? s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])) : ''; }
function clearUnemployedForm(){ document.getElementById('form-unemployed').reset(); delete document.getElementById('form-unemployed').dataset.editIndex; }
function clearEmployerForm(){ document.getElementById('form-employer').reset(); delete document.getElementById('form-employer').dataset.editIndex; }
function clearVacancyForm(){ document.getElementById('form-vacancy').reset(); delete document.getElementById('form-vacancy').dataset.editIndex; }
function clearMatch(){ document.getElementById('match-unemployed').value=''; document.getElementById('match-results').innerHTML=''; }

/* --- Seed sample data for quick demo --- */
function seedSample(type){
  const d = loadData();
  if(type==='unemployed'){
    d.unemployed.push(
      {name:'–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞', age:28, education:'–í—ã—Å—à–µ–µ', exp:2, prof:'–ú–µ–Ω–µ–¥–∂–µ—Ä', skills:'Excel, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π'},
      {name:'–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', age:35, education:'–°—Ä–µ–¥–Ω–µ–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ', exp:8, prof:'–°–ª–µ—Å–∞—Ä—å', skills:'–†–µ–º–æ–Ω—Ç'},
      {name:'–û–ª—å–≥–∞ –°–º–∏—Ä–Ω–æ–≤–∞', age:24, education:'–í—ã—Å—à–µ–µ', exp:1, prof:'–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç', skills:'JavaScript, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π'}
    );
  } else if(type==='employers'){
    d.employers.push({name:'–û–û–û –†–æ–º–∞—à–∫–∞', address:'–≥. –ê–ª–º–∞—Ç—ã, —É–ª. –õ–µ–Ω–∏–Ω–∞ 10'},{name:'–¢–ö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', address:'–≥. –ù—É—Ä-–°—É–ª—Ç–∞–Ω, –ø—Ä. –ù–∞–∑–∞—Ä–±–∞–µ–≤–∞ 5'});
  } else if(type==='vacancies'){
    d.vacancies.push(
      {title:'–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º', company:'–û–û–û –†–æ–º–∞—à–∫–∞', req:'–û–ø—ã—Ç –ø—Ä–æ–¥–∞–∂, –ü–ö, Excel', exp:1, salary:'–æ—Ç 120000', date:todayISO()},
      {title:'–°–ª–µ—Å–∞—Ä—å-—Ä–µ–º–æ–Ω—Ç–Ω–∏–∫', company:'–¢–ö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', req:'–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç', exp:3, salary:'–æ—Ç 90000', date:todayISO()},
      {title:'Frontend developer', company:'IT Solutions', req:'JavaScript, HTML, CSS, –ê–Ω–≥–ª–∏–π—Å–∫–∏–π', exp:1, salary:'150000', date:todayISO()}
    );
  }
  saveData(d);
  renderAll();
}

/* --- Misc UI wiring --- */
document.getElementById('search-unemployed').addEventListener('input', e=> renderUnemployed(e.target.value));
document.getElementById('search-employers').addEventListener('input', e=> renderEmployers(e.target.value));
document.getElementById('search-vacancies').addEventListener('input', e=> renderVacancies(e.target.value));

/* Clear all storage (dev) */
function clearAllData(){
  if(!confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ localStorage?')) return;
  localStorage.removeItem(LS_KEY);
  renderAll();
}

/* --- Initial render --- */
function renderAll(){
  renderUnemployed();
  renderEmployers();
  renderVacancies();
  renderMatchSelect();
  renderDashboard();
}
function renderMatchSelect(){
  refreshMatchSelect();
}
function renderDashboard(){
  // update recent + stats already handled by render functions
  renderUnemployed();
  renderVacancies();
}
renderAll();

</script>
<!-- UNIVERSAL MODAL -->
<div class="modal fade" id="myModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">–ú–æ–¥–∞–ª —Ç–µ—Ä–µ–∑–µ</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body" id="modalBody">
        –ú“±–Ω–¥–∞ –∫–µ–∑ –∫–µ–ª–≥–µ–Ω —Ç–µ–∫—Å—Ç –Ω–µ–º–µ—Å–µ —Ñ–æ—Ä–º–∞ —à—ã“ì–∞—Ä–∞ –∞–ª–∞—Å—ã“£.
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ñ–∞–±—É</button>
      </div>

    </div>
  </div>
</div>

</body>
</html>
